"use strict";(self.webpackChunkts_vue=self.webpackChunkts_vue||[]).push([[459],{4864:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var r=n(5393),i=(0,r._)("h1",null,"sip.js测试",-1),o=(0,r._)("video",{id:"remoteVideoElement",style:{width:"480px",height:"320px"}},null,-1),c=(0,r._)("video",{id:"remoteVideoElement1",style:{width:"480px",height:"320px"}},null,-1),a=(0,r._)("video",{id:"remoteVideoElement2",style:{width:"480px",height:"320px"}},null,-1),s=(0,r._)("video",{id:"localVideoElement",style:{width:"480px",height:"320px"},muted:"muted"},null,-1),l=n(2085),d=n(7991),u=n(45),m=n(789),p=n(1830);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h={setup:function(){var e=null,t=[],n={initSipJs:function(){document.getElementById("remoteVideoElement"),document.getElementById("localVideoElement");var t={uri:d.Z.makeURI("sip:1001@fs2.fnptt.cn"),authorizationUsername:"1001",authorizationPassword:"12345",transportOptions:{server:"wss://fs2.fnptt.cn:7443/"},delegate:{onInvite:n.receiveCall}};e=new d.Z(t);var r=new u.T(e);e.start().then((function(){r.register().then((function(e){console.log("yyh-注册成功",e),r.stateChange.addListener((function(e){console.log("yyh-registerer.stateChange",r.stateChange,r.state)}))})).catch((function(e){console.log("yyh-注册失败",e)}))}))},receiveCall:function(e){l.Z.confirm({content:function(){return"有新的来电"},cancelText:function(){return"挂断"},okText:"接听",onCancel:function(){e.reject()},onOk:function(){e.accept({sessionDescriptionHandlerOptions:{constraints:{audio:!0,video:!0}}})}});var t=document.getElementById("remoteVideoElement"),n=document.getElementById("remoteVideoElement1"),r=document.getElementById("remoteVideoElement2"),i=document.getElementById("localVideoElement");e.stateChange.addListener((function(o){switch(o){case m.s.Establishing:break;case m.s.Established:var c=e.sessionDescriptionHandler.peerConnection;if(c.getReceivers()){var a=new MediaStream;c.getReceivers().forEach((function(e){e.track&&a.addTrack(e.track)})),t.srcObject=a,n.srcObject=a,r.srcObject=a,t.play(),n.play(),r.play()}break;case m.s.Terminating:break;case m.s.Terminated:t.srcObject=null,n.srcObject=null,r.srcObject=null,i.srcObject=null,t.pause(),n.pause(),r.pause(),i.pause();break;default:throw new Error("Unknown session state.")}}))},call:function(t){document.getElementById("remoteVideoElement"),document.getElementById("localVideoElement");var r=d.Z.makeURI("sip:".concat(t,"@fs2.fnptt.cn")),i=new p.M(e,r,{sessionDescriptionHandlerOptions:{constraints:{audio:!0,video:!0}},extraHeaders:["X-Yyh-By-Someone: Username"]});i.invite(),n.onInvite(i)},handleRemoteVideo:function(e){t.push(e);var n=e.sessionDescriptionHandler.peerConnection;if(n.getReceivers()){var r=new MediaStream;if(n.getReceivers().forEach((function(e){e.track&&r.addTrack(e.track)})),1===t.length){var i;(i=document.getElementById("remoteVideoElement")).srcObject=r,i.play();var o=document.getElementById("remoteVideoElement1");o.srcObject=r,o.play();var c=document.getElementById("remoteVideoElement2");c.srcObject=r,c.play()}2===t.length&&((i=document.getElementById("remoteVideoElement1")).srcObject=r,i.play()),3===t.length&&((i=document.getElementById("remoteVideoElement2")).srcObject=r,i.play()),navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(e){n.getSenders().forEach((function(t){"video"==t.track.kind&&t.replaceTrack(e.getVideoTracks()[0]),"audio"==t.track.kind&&t.replaceTrack(e.getAudioTracks()[0])})),e.getVideoTracks()[0].addEventListener("ended",(function(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){n.getSenders().forEach((function(t){"video"==t.track.kind&&t.replaceTrack(e.getVideoTracks()[0]),"audio"==t.track.kind&&t.replaceTrack(e.getAudioTracks()[0])}))})).catch((function(e){}))}))})).catch((function(){}))}},onInvite:function(e){e.stateChange.addListener((function(t){switch(t){case m.s.Initial:case m.s.Establishing:break;case m.s.Established:n.handleRemoteVideo(e);break;case m.s.Terminating:case m.s.Terminated:break;default:throw new Error("Unknown session state.")}}))},handleInitSipJs:function(){var t={uri:d.Z.makeURI("sip:1001@fs2.fnptt.cn"),authorizationUsername:"1001",authorizationPassword:"1234",transportOptions:{server:"wss://fs2.fnptt.cn:7443/"},delegate:{onInvite:n.receiveCall}};e=new d.Z(t)}};return(0,r.bv)((function(){n.initSipJs()})),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n)}},v=(0,n(3744).Z)(h,[["render",function(e,t,n,l,d,u){return(0,r.wg)(),(0,r.iD)("div",null,[i,o,c,a,s,(0,r._)("div",null,[(0,r._)("button",{onClick:t[0]||(t[0]=function(t){return e.call(1010)})},"呼叫1010"),(0,r._)("button",{onClick:t[1]||(t[1]=function(t){return e.call(1005)})},"呼叫1005"),(0,r._)("button",{onClick:t[2]||(t[2]=function(t){return e.call("wk123456")})},"呼叫zjsw00028")])])}]])}}]);